{% extends "base.html" %}
{% block content %}
<style>
    /* debug only */
/* .selectize-dropdown {
    display: block !important; 
} */
</style>
<div class="container-fuild flex-grow">
    <div class="row justify-content-center">
        <div class="col-12">
            <div class="row jumbotron-wrapper">
                <div class="jumbotron mx-5">
                    <h1 class="display-6">Single Cell Analysis and VIsualization (scAVI)</h1>
                    <p class="lead">
                        is a web-based platform developed to enable users to analyze and visualize published and not published single cell RNA sequencing (scRNA-seq) datasets with state-of-the-art algorithms and visualization methods.
                    </p>
                    <p class="lead" id="stats">
                        The scAVI platform supports the analysis and visualization of {{ stats['n_studies'] }} publicly available scRNA-seq studies from GEO covering {{ "{:,}".format(stats['n_cells']) }} single cells/samples. Analyses are provided as <a href="{{url_for('all_datasets')}}">{{ stats['n_studies'] }} dedicated landing pages</a> and Jupyter Notebook reports for each study.
                    </p>
                </div>
            </div>
        </div>
    </div>
    <div class="row mx-5 mt-3">
        <div class="col-6">        
            <!-- <h1>scRNA-seq Tools</h1> -->
            
            <h3>scAVI currently contains implementations of the following methods:</h3>
            <hr>
            <!-- <ol>
            {% for section in sections %}
                <li>{{ section.section_name }}</li>
                <ul>
                {% for tool in section['tools'] %}
                    {% if tool.reference_link != '' %}
                        <li><a href="{{tool.reference_link}}" target="_blank">{{ tool.tool_name }}</a></li>
                    {% else %}
                        <li>{{ tool.tool_name }}</li>
                    {% endif %}
                {% endfor %}
                </ul>
            {% endfor %}
            </ol> -->

            <ul class="list-unstyled">
                <li class="tool-section-name">Exploratory Data Analysis and Visualization</li>
                <ul>
                    <li>2D and 3D PCA, t-SNE, and Monocole visualization of single cells</li>
                    <li>Library Size Analysis</li>
                    <li>K-means clustering</li>
                </ul>
                <li class="tool-section-name">Data Imputation</li>
                <ul>
                    <li>MAGIC - A diffusion-based imputation method to predict dropout expression</li>
                </ul>
                <li class="tool-section-name">Trajectory Inference Analysis</li>
                <ul>
                    <li>Monocle trajectory inference</li>
                </ul>
                <li class="tool-section-name">Cell Type Predictions</li>
                <ul>
                    <li>SingleR cell type prediction</li>
                    <li>Cell type predictions with Enrichr and ARCHS4</li>
                </ul>
                <li class="tool-section-name">Enrichment Analysis</li>
                <ul>
                    <li>Gene Ontology, KEGG, WikiPathways, MGI, HPO, transcription factor enrichment analysis with ENCODE and ChEA, kinase and miRNA enrichment analysis</li>
                </ul>
            </ul>

            <!-- <h3>Coming soon...</h3> -->
        </div>
        <div class="col-6">
            <div class="col-12">
                <h3>Explore public scRNA-seq datasets</h3>
                <div class="input-group mb-3">
                    <input id="main-search-box" type="text" class="form-control" placeholder="e.g. GSE82187, reprogramming">
                    <div class="input-group-append">
                        <button class="btn btn-outline-secondary" type="button">Search</button>
                    </div>
                </div>
                      
            </div>
        </div>
    <!-- <div class="col-6">
        <h1>Video tutorials</h1>
        <hr>
        <p>To be added...</p>
    </div> -->
    </div>
</div>

{% endblock %}

{% block scripts %}
<script>
    var aClicked = function(href){ // simulate <a> clicked
        location.href = href;
    }

    // Search bar
    var selectizeDom = $("#main-search-box").selectize({
        create: false,
        maxItems: 1,
        closeAfterSelect: false,
        options: [],
        labelField: 'geo_accession',
        valueField: 'geo_accession',
        searchField: ['title', 'geo_accession'],
        placeholder: 'e.g. GSE82187, reprogramming',
        render: {
            option: function(item, escape){
                var notebookUrl = 'view_notebook/' + item.notebook_uid + '/' + item.geo_accession;
                var visUrl = 'graph_page/' + item.geo_accession + '/tSNE';

                var html = '<div class="geo-item">';
                html += '<span class="badge badge-secondary mr-1">'+ item.geo_accession +'</span>'
                if (item.organism === 'human') {
                    html += '<span class="badge badge-human">'+ item.organism +'</span>'    
                } else {
                    html += '<span class="badge badge-mouse">'+ item.organism +'</span>'    
                }
                
                html += '<span class="geo-title">' + item.title + '</span>'
                html += '<ul class="geo-meta list-inline">'
                html += '<li class="list-inline-item">Cells: <span class="geo-n-cells">' + item.n_cells + '</span></li>'
                html += '<li class="list-inline-item">Date: <span class="geo-date">' + item.submission_date + '</span></li>'
                html += '</ul>'

                html += '<a onmousedown="aClicked(this.href);" class="btn btn-sm btn-outline-info mx-1" href="'+ visUrl + '">Viewer</a>'
                if (item.notebook_uid !== null){
                    html += '<a onmousedown="aClicked(this.href);" class="btn btn-sm btn-info" href="'+ notebookUrl + '">Notebook</a>'
                }

                html += '</div>'
                return html;
            }
        },
        load: function(query, callback){
            if (query.length > 1){
                $.ajax({
                    url: 'q?query=' + encodeURIComponent(query),
                    type: 'GET',
                    dataType: 'json',
                    error: function(){
                        callback();
                    },
                    success: function(res){
                        console.log(res)
                        return callback(res['results']);
                    }
                });
            }
        },
        onItemAdd: function (value, $item) {  
        }
    });

</script>
{% endblock %}
